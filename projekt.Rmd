---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
author: "Valentina Pucer"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
#uvoz vseh potrebnih knjižic
source("lib/libraries.r", encoding = "UTF-8")
source("uvoz/uvoz.r", encoding = "UTF-8")
source("vizualizacija/vizualizacija.r")
```



# 1.FAZA: Izbira teme

Za tematiko svoje seminarske naloge sem si izbrala analizo podatkov naravnih nesreč v Združenih državah Amerike iz radovednosti, da izvem, v kakšnem obsegu so naravne nesreče na drugi strani sveta, koliko denarne škode povzročijo..ipd.Naloge sem se lotila tako, da sem podatke iz spletne strani prenesla v program Microsoft Office Excel Worksheet in oblikovala tabelo, ki se  od originalne razlikuje v tem, da je nekaj odvečnih podatkov odstranjenih, nekaj dodanih in urejenih. Drugo tabelo sem uvozila iz spletne strani in jo tudi preuredila. Nanaša  se na podatke o številu smrtnih žrtev v dani naravni nesreči. 

***

#2.FAZA: Obdelava, uvoz in čiščenje podatkov

Podatke sem uvozila v obliki .csv in direkt s spletne strani:

* 'https://en.wikipedia.org/wiki/List_of_natural_disasters_in_the_United_States'

*  'https://en.wikipedia.org/wiki/List_of_disasters_in_the_United_States_by_death_toll'

* 'https://en.wikipedia.org/wiki/List_of_U.S._states_by_GDP_per_capita'


###Tabela nesrece

Pri prvem uvozu sem tabeli uredila stolpce,tako da sem zamenjala njihov vrstni red, odvečni zadnji stolpec prvotne tabele pobrisala. Pobrisala sem tudi posamezne odvečne znake, ki so se pojavili v tabeli. Urediti sem morala tudi števila npr. jih iz nizov dati v as.numeric. Pri filtraciji podatkov sem glede na stolpec Škoda ocenila tip(stopnjo) škode in temu dodala nov stolpec.

Spremenljivke pri prvi tabeli:

* ta dogodek(imenska spremenljivka)

* lokacija(imenska spremenljivka ....(za zemljevid))

* leto, v katerem se je nesreča pripetila (številska spremenljivka)

* tip naravne nesreče, ki se je pripetila (imenska spremenljivka)

* število smrtnih žrtev(urejenostna smremenljivka (številska), HUDO, NI HUDO)

* denarna škoda(urejenostna,....VELIKA ŠKODA, MANJŠA ŠKODA)


```{r razpredelnica1, echo=FALSE}
kable(head(nesrece))

```

###Tabela1

V drugem uvozu sem  večidel stolpcev pobrisala. Ostala sta le dva prvotna in tretji, ki se nanaša na število smrtnih žrtev pri neki naravni nesreči(stopnja smrti oz.umrljivosti).Tudi tukaj sem morala številske podatke prečistiti na ta način, da sem se znebila posameznih odvečnih znakov in jih iz nizov pretvorila v številski podatek, s katerim sem potem lahko upravljala.

```{r razpredelnica2, echo=FALSE}
kable(head(tabela1))

```


Ideja za napoved podatkov v naslednji fazi: Iz prve tabele odvisnost ocenjene škode od lokacije naravne nesreče (razvitost območja) ali pa vpliv tipa naravne nesreče na stopnjo denarje škode. Lahko bi sklepala, da bodo posamezne manj razvite lokacije, kjer so se naravne nesreče zgodile, imele več denarne škode, ker imajo manj sredstev za vlaganje v zavarovanje pred temi dogodki (protipoplavni nasipi,
protipotresne zgradbe), s pomočjo katerih je škoda manjša. Še vedno pa moramo upoštevati, da imajo vpliv na stopnjo denarne škode tudi drugi dejavniki, saj ne morem enačiti hurikana s poplavo.


#3.FAZA: Analiza in vizualizcija


```{r torta1, echo=FALSE, fig.align='center', fig.cap='Tortni diagram'}
slices <- tabela1$Stopnja_smrti
lbls <- c('Veliko','Malo')
pie3D(table(slices), labels=lbls, explode=0.15, start=1.5, labelrad=1.18, labelcex=1, main='Tortni diagram')
```

```{r graf1, echo=FALSE, warning=TRUE, fig.cap='Ta graf prikazuje število žrtev z več kot 600 ljudmi'}
ggplot(tabela1 %>% group_by(Year) %>% summarise(Fatalities = sum(Fatalities)) %>%
         filter(Fatalities >= 600),
       aes(x = factor(Year), y = Fatalities)) + geom_bar(stat = "identity") +
  coord_flip() + xlab("Year")
```

Dana tabela prikazuje, kako seštevilo smrtni žrtev ki je večje od števila 600, spreminja skozi leta. Opazimo lahko, da je  število smrtnih žrtev v 19.stoletju približno 2000 na pripadajoče leto. Izjema je leto 1893, kjer je 3000 smrtnih žrtev.


#Zemljevid

Spodnji zemljevid prikazuje gostoto smrtnih žrtev iz podatkov v tabeli1 na posameznih območjih v ZDA.

```{r zemljevid1, echo=FALSE}
ggplot() + geom_polygon(data = zdruzena.tabela %>% group_by(State) %>%
                          summarise(Fatalities = sum(Fatalities)) %>%
                          right_join(zem, by = c("State" = "STATE_NAME")),
                        aes(x = long, y = lat, group = group, fill = Fatalities))

```



Uvozila bom  novo tabelo, ki bo prikazovala BDP za posamezne države od 2007 do 2012. Za vsako področje bom izračunala povprečni BDP.

```{r razpredelnica3, echo=FALSE}
kable(head(tabelaBDP))

```


#4.FAZA: Napredna analiza

```{r napr_analiza, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
source("analiza/analiza.r", encoding = "UTF-8")
```

Na podlagi tabele tabela_1 bom analizirala, kako je povprečni  BDP povezan s škodo in številom smrtnih žrtev oz. ali je sploh povezan. 

```{r razpredelnica4, echo=FALSE}
kable(head(tabela_1))

```

Spodnji graf prikazuje povprečni BDP /1000 (zaradi ogromnih števil) v odvisnosti od škode, ki je nastala pri posamezni naravni nesreči. Slučajna spremenljivka ŠKODA ima lognormalno porazdelitev. Grafični prikaz nam pove, da je pri nižjem BDP, ki sem  ga izbrala kot indikator za razvitost posameznega območja, škoda večja. To potrdi mojo predpostavko, da načeloma velja, da tiste države, ki so bolj razvite, so bolj pripravljene na naravne katastrofe, saj imajo več sredstev za vlaganje v to, da se zavarujejo pred njimi. Seveda pa so, tako kot povsod, tudi tukaj prisotna odstopanja zaradi izjem. 

```{r graf2, echo=FALSE, warning=TRUE, fig.cap='Odvisnost povprečnega BDP od škode'}
ggplot(tabela_1, aes(x = PovprecjeBDP/1000, y = Škoda/1e9)) + geom_point()+geom_smooth(method = "lm")

```

V grafu "Odvisnost povprečnega BDP od števila smrtnih žrtev" vidimo ponovno, da je porazdelitev lognormalna, kar je ponavadi značilno za število ljudi v odvisnosti od nečesa-povprečni BDP. Nižji kot je povprečni BDP glede na lokacijo, kjer se je naravna nesreča zgodila, nižje bo število smrtnih žrtev in obratno.
Tudi tukaj moremo upoštevat seveda izjeme, npr. pri nižjem povprečnem BDP, kjer je bilo število smrtnih žrtev manjše, je najverjetne naravna nesreča bolj blaga oz. v manjšem obsegu.




```{r graf3, echo=FALSE, warning=TRUE, fig.cap='Odvisnost povprečnega BDP od števila smrtnih žrtev'}
ggplot(tabela_1, aes(x = PovprecjeBDP/1000, y = Smrtne.žrtve)) +
geom_point()+geom_smooth(method = "lm")
```


Nadslednja tabela: tabela_3 je nastala na podlagi tabele nesrece, kjer sem 
pobrala le podatke naravnih nesreč, katerih tip je poplava(flood).
Ta tip naravne nesreče sem si izbralam ker se v tabeli pojavi najpogosteje.
Primerjala bom BDP s stopnjo škode in številom smrtnih žrtev za posamezen dogodek. Moja primerjava bo tako boljša, saj bom imela posamezne dogodke z enakim tipom naravne nesreče.



***



